<?xml version="1.0" encoding="UTF-8"?>

<xwikidoc>
<web>Main</web>
<name>RecentChanges</name>
<language></language>
<defaultLanguage>en</defaultLanguage>
<translation>0</translation>
<parent>Main.Dashboard</parent>
<creator>XWiki.Admin</creator>
<author>XWiki.Admin</author>
<customClass></customClass>
<contentAuthor>XWiki.Admin</contentAuthor>
<creationDate>1252458000000</creationDate>
<date>1287582416000</date>
<contentUpdateDate>1287582416000</contentUpdateDate>
<version>1.1</version>
<title>$msg.get("xe.recentchanges")</title>
<template></template>
<defaultTemplate></defaultTemplate>
<validationScript></validationScript>
<comment></comment>
<minorEdit>false</minorEdit>
<syntaxId>xwiki/2.0</syntaxId>
<hidden>false</hidden>
<attachment>
<filename>lquo.gif</filename>
<filesize>185</filesize>
<author>XWiki.Admin</author>
<date>1233652764000</date>
<version>1.1</version>
<comment></comment>
<content>R0lGODlhFgAWALMPAPP09ufq7LjAx3GBjpWgqlpse9zf48TK0H2LmKy1vWZ2hdDV2YmWoaGrtE5hcv///yH5BAEAAA8ALAAAAAAWABYAAARm8MlJq704682734lTBBRAOEOGOOwxBQrrkFYjM9QgN1cgCxQBq7DAnByEis4BxBRYxYlBBsD4ZAOD5CBzMKqVq6xQFXYRFkC39eCutZVYF6h+W0Jj8JGVupizFEcINB+FhoeIiRcRADs=</content>
</attachment>
<attachment>
<filename>rquo.gif</filename>
<filesize>184</filesize>
<author>XWiki.Admin</author>
<date>1233652771000</date>
<version>1.1</version>
<comment></comment>
<content>R0lGODlhFgAWALMPAKy1vdDV2efq7Fpse8TK0HGBjmZ2hbjAx5WgqqGrtImWofP09n2LmNzf405hcv///yH5BAEAAA8ALAAAAAAWABYAAARl8MlJq7046827z0HhDAdFGI4RXMLgvA4hBfDbWEDtFBKiIzido6fjVVo6wYNWM1wCKNiE0MxQd5WcQ5HxORIVxqt00TqUk8RrsLAsFDDARCB6ySwHGDcdxyDlFDQkH4SFhoeIGxEAOw==</content>
</attachment>
<object>
<class>
<name>XWiki.StyleSheetExtension</name>
<customClass></customClass>
<customMapping></customMapping>
<defaultViewSheet></defaultViewSheet>
<defaultEditSheet></defaultEditSheet>
<defaultWeb></defaultWeb>
<nameField></nameField>
<validationScript></validationScript>
<cache>
<cache>0</cache>
<disabled>0</disabled>
<displayType>select</displayType>
<multiSelect>0</multiSelect>
<name>cache</name>
<number>5</number>
<prettyName>Caching policy</prettyName>
<relationalStorage>0</relationalStorage>
<separator> </separator>
<separators> ,|</separators>
<size>1</size>
<unmodifiable>0</unmodifiable>
<values>long|short|default|forbid</values>
<classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
</cache>
<code>
<disabled>0</disabled>
<name>code</name>
<number>2</number>
<prettyName>Code</prettyName>
<rows>20</rows>
<size>50</size>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
</code>
<name>
<disabled>0</disabled>
<name>name</name>
<number>1</number>
<prettyName>Name</prettyName>
<size>30</size>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.StringClass</classType>
</name>
<parse>
<disabled>0</disabled>
<displayFormType>select</displayFormType>
<displayType>yesno</displayType>
<name>parse</name>
<number>4</number>
<prettyName>Parse content</prettyName>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
</parse>
<use>
<cache>0</cache>
<disabled>0</disabled>
<displayType>select</displayType>
<multiSelect>0</multiSelect>
<name>use</name>
<number>3</number>
<prettyName>Use this extension</prettyName>
<relationalStorage>0</relationalStorage>
<separator> </separator>
<separators> ,|</separators>
<size>1</size>
<unmodifiable>0</unmodifiable>
<values>currentPage=Always on this page|onDemand=On demand|always=Always on this wiki</values>
<classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
</use>
</class>
<name>Main.RecentChanges</name>
<number>0</number>
<className>XWiki.StyleSheetExtension</className>
<guid>ab40f34b-0de4-4e6a-a6c8-f03dce1d6db5</guid>
<property>
<cache>default</cache>
</property>
<property>
<code>#template('colorThemeInit.vm')
/* General table style */

table.recentChanges {
  border-collapse: separate;
  margin: 0 !important;
  width: 100%;
}

.recentChangesDate {
  font-size: .8em;
  font-weight: 700;
}

.recentChangesLeft {
  background-color: $theme.backgroundSecondaryColor;
  border: 0 !important;
  padding: 1em !important;
  text-align: center;
  vertical-align: top !important;
  width: 20%;
}

.recentChangesLeft img {
  max-height: 50px;
  max-width: 50px;
}
/* IE6 doesn't understand max-* */
* html .recentChangesLeft img {
  width: 50px;
}

.recentChangesRight {
  border: 0 !important;
  padding: 0 0 1em 0 !important;
  vertical-align: top !important;
  width: 80%;
}

.recentChangesHeader {
  display: none;
}

.recentChangesMoreActions {
  margin: 0 !important;
  text-align: right;
}

/* List styles */

.rcVersion {
  font-size: .8em;
}

.rcVersion .newVersion {
  color: red;
}

ul.xlist li.xitem div.modifiedPage {
  float: left;
}

ul.xlist li.xitem div.modifiedPageActions a.ajax {
  color: $theme.textSecondaryColor;
  text-decoration: none;
}

/* Attachment lists */

li.attachment {
  background-image: url($xwiki.getSkinFile("icons/silk/attach.gif"));
  background-position: 2px 1px;
  border-bottom: 0;
  font-size: .9em;
  padding-top: 0;
}

/* Comments divs */

div.commentQuote {
  background-repeat: no-repeat;
  height: 22px;
  width: 22px;
}

div.lQuo {
  background-image: url($doc.getAttachmentURL("lquo.gif"));
  float: left;
}

div.rQuo {
  background-image: url("$doc.getAttachmentURL('rquo.gif')");
  float: right;
}

div.comment {
  margin-left: 32px;
  margin-right: 32px;
  text-indent: 1em;
}

div.commentContainer, div.attachmentContainer {
  border-top: 1px dashed $theme.borderColor;
  clear: both;
  overflow: hidden;
  padding: .5em 0;
}

div.commentAdd {
  font-size: .8em;
  padding: 0 .5em 0 0;
  text-align: right;
}

/*  Hidden elements in lists that are show on hover  */

ul.xlist li.xitem div.xshowonhover {
  display: none;
  float: right;
  font-size: .8em;
  padding: 0 .5em 0 0;
}

ul.xlist li.xitem:hover div.xshowonhover {
  display: block;
}</code>
</property>
<property>
<name>Recent Changes CSS</name>
</property>
<property>
<parse>1</parse>
</property>
<property>
<use>onDemand</use>
</property>
</object>
<object>
<class>
<name>XWiki.WikiMacroClass</name>
<customClass></customClass>
<customMapping></customMapping>
<defaultViewSheet></defaultViewSheet>
<defaultEditSheet></defaultEditSheet>
<defaultWeb></defaultWeb>
<nameField></nameField>
<validationScript></validationScript>
<code>
<disabled>0</disabled>
<name>code</name>
<number>9</number>
<prettyName>Macro code</prettyName>
<rows>20</rows>
<size>40</size>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
</code>
<contentDescription>
<disabled>0</disabled>
<name>contentDescription</name>
<number>8</number>
<prettyName>Content description (Not applicable for "No content" type)</prettyName>
<rows>5</rows>
<size>40</size>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
</contentDescription>
<contentType>
<cache>0</cache>
<disabled>0</disabled>
<displayType>select</displayType>
<multiSelect>0</multiSelect>
<name>contentType</name>
<number>7</number>
<prettyName>Macro content type</prettyName>
<relationalStorage>0</relationalStorage>
<separator>|</separator>
<separators>|</separators>
<size>1</size>
<unmodifiable>0</unmodifiable>
<values>Mandatory|Optional|No content</values>
<classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
</contentType>
<defaultCategory>
<disabled>0</disabled>
<name>defaultCategory</name>
<number>4</number>
<prettyName>Default category</prettyName>
<size>30</size>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.StringClass</classType>
</defaultCategory>
<description>
<disabled>0</disabled>
<name>description</name>
<number>3</number>
<prettyName>Macro description</prettyName>
<rows>5</rows>
<size>40</size>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
</description>
<id>
<disabled>0</disabled>
<name>id</name>
<number>1</number>
<prettyName>Macro id</prettyName>
<size>30</size>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.StringClass</classType>
</id>
<name>
<disabled>0</disabled>
<name>name</name>
<number>2</number>
<prettyName>Macro name</prettyName>
<size>30</size>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.StringClass</classType>
</name>
<supportsInlineMode>
<disabled>0</disabled>
<displayFormType>select</displayFormType>
<displayType>yesno</displayType>
<name>supportsInlineMode</name>
<number>5</number>
<prettyName>Supports inline mode</prettyName>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
</supportsInlineMode>
<visibility>
<cache>0</cache>
<disabled>0</disabled>
<displayType>select</displayType>
<multiSelect>0</multiSelect>
<name>visibility</name>
<number>6</number>
<prettyName>Macro visibility</prettyName>
<relationalStorage>0</relationalStorage>
<separator>|</separator>
<separators>|</separators>
<size>1</size>
<unmodifiable>0</unmodifiable>
<values>Current User|Current Wiki|Global</values>
<classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
</visibility>
</class>
<name>Main.RecentChanges</name>
<number>0</number>
<className>XWiki.WikiMacroClass</className>
<guid>8891cf6c-541d-4e15-8986-ca230207525e</guid>
<property>
<code>{{velocity output="none"}}
##
## CSS to load style the recent changes page.
##
$xwiki.ssx.use("Main.RecentChanges")

#*
 * Gets the list (java.util.List) of elements in $arrayAsString, and puts them in the $list.
 * 
 * @param $arrayAsString the string form of the array, similar to the java syntax for a macro ({elt1, elt2, etc}), or without the {}
 * @param $list the variable to put the resulted list into. It will be (re)initialized and emptied by this macro
 * FIXME: this is gonna fail for lists with '{' in the string or ','. Need to escape
 *#
#macro(asList $arrayAsString $list)
  #if("$!arrayAsString" != "")
    #set($list = [])
    ## if the string is surrounded by {}, eliminate and then parse as list
    #if($arrayAsString.startsWith('{') &amp;&amp; $arrayAsString.endWith('}'))
      #set($endIndex = $arrayAsString.length() - 1)
      #set($arrayAsString = $arrayAsString.substring(1, $endIndex))
    #end
    ## parse the array serialized as string and fill in the list
    #set($valuesArray = $arrayAsString.split(","))  
    #foreach($value in $valuesArray)
      #if($value.trim().length())
        #set($dispose = $list.add($value.trim()))
      #end
    #end
  #end
#end
## Start execution timer
##
#set($execStart = $util.getDate())
## reset the variables from the velocity before getting the values from the request, because otherwise the macro params don't override the values which keep the existing values set in velocity
## Manage minor edits.
#set($rcShowMinor = $util.null)
#setVariableFromRequest($rcShowMinor, "rcShowMinor", $util.parseBoolean($context.macro.params.get('showMinor')))
show minor $rcShowMinor $rcShowMinor.class &lt;br /&gt;
## Manage show diff in items.
#set($rcShowDiff = $util.null)
#setVariableFromRequest($rcShowDiff, "rcShowDiff", $util.parseBoolean($context.macro.params.get('showDiff')))
## Manage show RSS links.
#set($rcShowRss = $util.null)
#setVariableFromRequest($rcShowRss, "rcShowRss", $util.parseBoolean($context.macro.params.get('showRss')))
## Manage number of changes to display.
#set($rcChangesNb = $util.null)
## sentinel is -1 because 0 might be set from request to force showing all changes
#setVariableFromRequest($rcChangesNb "rcChangesNb", -1)
#if($rcChangesNb == -1)
  #set($rcChangesNbString = $context.macro.params.get('changesNb'))
  #if($rcChangesNbString != "")
    ## TODO: this will return 0 if $recentChangesString is not an integer
    #set($rcChangesNb = $util.parseInt($rcChangesNbString))
  #else
    #set($rcChangesNb = 30)
  #end
#end
## Manage tag criterion
#set($rcTag = $util.null)
#setVariableFromRequest($rcTag, "rcTag", [])
#if($rcTag.size() == 0)
  #set($rcTagString = $context.macro.params.get('tag'))
  #asList($rcTagString, $rcTag)
#end
## Manage space criterion
#set($rcSpace = $util.null)
#setVariableFromRequest($rcSpace, "rcSpace", [])
#if($rcSpace.size() == 0)
  #set($rcSpaceString = $context.macro.params.get('space'))
  #asList($rcSpaceString, $rcSpace)
#end
## Manage author criterion
#set($rcAuthor = $util.null)
#setVariableFromRequest($rcAuthor, "rcAuthor", [])
#if($rcAuthor.size() == 0)
  #set($rcAuthorString = $context.macro.params.get('author'))
  #asList($rcAuthorString, $rcAuthor)
#end
{{/velocity}}

{{velocity}}
##
## Create a string containing one or more ? given the number of values in the passed list.
##
#macro(createQueryParameters $values $parameters)
  #foreach($value in $values)
    #if($parameters == "")
      #set($parameters = "?")
    #else
      #set($parameters = "${parameters}, ?")
    #end
  #end
#end
##
## Retrieve recently changed documents.
##
#set($criteria = $util.getHashMap())
#if(!$xwiki.hasMinorEdit() || $rcShowMinor)
  #set ($hqlQuery = "where 1=1 order by doc.date desc")
#else
  #set ($hqlQuery = "where doc.version like '%.1'#if(!$isAdvancedUser) and doc.author != 'superadmin'#end order by doc.date desc")
#end
## Create space criterion.
#if($rcSpace.size() &gt; 0)
  #set($spaceParameters = "")
  #createQueryParameters($rcSpace $spaceParameters)
  #set($discard = $criteria.put("doc.space in (${spaceParameters})", $rcSpace))
#end
## Create tag criterion.
#if("$!xwiki.getPlugin('tag')" != "" &amp;&amp; $rcTag.size() &gt; 0)
  #set($docsWithTag = $util.getArrayList())
  #foreach($item in $rcTag)
    #set($discard = $docsWithTag.addAll($xwiki.tag.getDocumentsWithTag($item)))
  #end
  #set($docsWithTagParameters = "")
  #createQueryParameters($docsWithTag $docsWithTagParameters)
  #set($discard = $criteria.put("doc.fullName in (${docsWithTagParameters})", $docsWithTag))    
#end
#if($rcAuthor.size() &gt; 0)
  #set($authorParameters = "")
  #createQueryParameters($rcAuthor $authorParameters)
  #set($discard = $criteria.put("doc.author in (${authorParameters})", $rcAuthor))
#end
## Exclude blacklisted spaces if displaying changes for a whole wiki
#if($rcSpace.size() == 0)
  #set($blacklistedSpacesParameters = "")
  #createQueryParameters($blacklistedSpaces $blacklistedSpacesParameters)
  #set($discard = $criteria.put("doc.space not in (${blacklistedSpacesParameters})", $blacklistedSpaces))
#end
#if($criteria.size() &gt; 0)
  ## If any, loop over criterias to add them to the query, then perform the query.
  #set($values = $util.getArrayList())       
  #foreach($criterion in $criteria.keySet())
    #if($criteria.get($criterion).size() &gt; 0)        
      #set($hqlQuery = $hqlQuery.replaceAll("where", "where ${criterion} and"))
      #set($discard = $values.addAll(0, $criteria.get($criterion)))
    #end
  #end
  #set($rcDocumentNames = $xwiki.searchDocuments($hqlQuery, $rcChangesNb, 0, $values))
#else
  ## No query criterion, perform the query as is.
  #set($rcDocumentNames = $xwiki.searchDocuments($hqlQuery, $rcChangesNb, 0))
#end
## 
## Prepare comments handling
#set($commentsOrder = false)
#if($xwiki.getSpacePreferenceAsInt('commentsorder', 1) == 0)
  #set($commentsOrder = true)
#end
##
## Comment handling macro.
## Retreive page's last comment if any and 
## overwrite variables if this comment is the last modification on the page.
##
#macro(handleComment $rcDoc $rcType $rcDt $commentsOrder)
  ## Retrieve comments from last to first.
  #set($rcComments = $rcDoc.getComments($commentsOrder))
  #if($rcComments.size() &gt; 0)
    ## Retrieve last comment.
    #set($lastComment = $listtool.get($rcComments, 0))
    #set($lastCommentDate = $lastComment.getProperty("date").getValue())
    ## If the last modification on the page is the comment, overwrite values.
    ## We don't test compareTo() == 0 since the comment date and the save date may vary a little bit.
    #if($lastCommentDate.compareTo($rcDt.toDate()) &gt; -1 &amp;&amp; $lastCommentDate.compareTo($rcDt.toDate()) &lt;= 1)
      #set($rcType = "comment")
    #end
  #end
#end
##
## Attachments handling macro.
## Retrieve page's attachments and put those which upload matches the modification entry (author and timeframe)
## in the $rcAttachments List.
##
#macro(handleAttachments $rcDoc $rcAuthor $rcDt)  
  #set($attachments = $rcDoc.getAttachmentList())
  #foreach($attachment in $attachments)
    #set($attachmentDt = $xwiki.jodatime.getDateTime($attachment.getDate().getTime()))
    #if($rcAuthor == $attachment.getAuthor() &amp;&amp; $rcDt.getYear() == $attachmentDt.getYear() &amp;&amp; $rcDt.getDayOfYear() == $attachmentDt.getDayOfYear())
      #set($discard = $rcAttachments.add($attachment))
    #end
  #end
#end
##
## 
##
#macro(displayRcAuthor $author)
  #mediumUserAvatar($author)
  &lt;br/&gt;&lt;span class="recentChangesAuthor"&gt;
  #if($author == "XWikiGuest")
    Guest
  #else    
    #set($userName = $xwiki.getUserName($author))
    #if($userName == "")
      ## userName can be empty when the page has been saved without specifying the author. 
      ## We're printing a non-breaking space to ensure xhtml validity (ie: avoid empty paragraph).
      &amp;nbsp;      
    #else
      $userName
    #end
  #end
  &lt;/span&gt;
#end
#macro(displayRcVersion $version)
  #if($version == "1.1")
    &lt;span class="rcVersion"&gt;(&lt;span class="newVersion"&gt;$msg.get("xe.recentchanges.entry.new")&lt;/span&gt;)&lt;/span&gt;
  #end
#end

##
## Display the recent changes list.
##  
#set($previousDt = $xwiki.jodatime.getDateTime(0))
#set($discard = $previousDate.setTime(0))
#set($previousAuthor = "")
## Get this very doc, useful when it is included from another one.
#set($recentChangesDoc = $xwiki.getDocument("Main.RecentChanges"))
{{html clean="false"}}
&lt;table class="recentChanges" summary="$msg.get('xe.recentchanges.summary')"&gt;
  &lt;tr class="recentChangesHeader"&gt;&lt;th scope="col"&gt;$msg.get("xe.recentchanges.column.authoranddate")&lt;/th&gt;&lt;th scope="col"&gt;$msg.get("xe.recentchanges.column.changes")&lt;/th&gt;&lt;/tr&gt;
  #foreach ($rcDocName in $rcDocumentNames)
    #set($row = "")
    #set($rcAttachments = $util.arrayList)
    ## Verify user access level on the document 
    #if ($xwiki.hasAccessLevel("view", $context.user, "${context.database}:${rcDocName}"))           
      #set($rcDoc = $xwiki.getDocument($rcDocName))
      #set($rcType = "page")
      #set($rcAuthor = $rcDoc.getAuthor()) ## TODO : check comments
      #set($rcDt = $xwiki.jodatime.getDateTime($rcDoc.getDate().getTime()))      
      ## The handleComment macro overwrites rcType variable if the last modification is a comment.
      #handleComment($rcDoc $rcType $rcDt $commentsOrder)
      ## The handleAttachments macro put a list of attachments uploaded during the day by the author in $rcAttachments.
      #handleAttachments($rcDoc $rcAuthor $rcDt)      
      #if($rcAuthor == $previousAuthor &amp;&amp; $rcDt.getYear() == $previousDt.getYear() &amp;&amp; $rcDt.getDayOfYear() == $previousDt.getDayOfYear())
        ## Same day and author, continue in the same row.
      #else
        ## Different day or author, end previous row and start a new one.        
        #if($velocityCount &gt; 1)&lt;/ul&gt;&lt;/td&gt;&lt;/tr&gt;#end ## close previous row if needed
        &lt;tr&gt;&lt;td class="recentChangesLeft"&gt;#displayRcAuthor($rcAuthor)&lt;br/&gt;
        &lt;span class="recentChangesDate"&gt;$xwiki.formatDate($rcDt.toDate(), "MMMM d")&lt;/span&gt;&lt;/td&gt;
        &lt;td class="recentChangesRight"&gt;&lt;ul class="xlist"&gt; ## open next cell
      #end
      ## Compute a GUID for this modification with page name, modification date and author.
      #set($modGUID = "${rcDoc.fullName}_${xwiki.formatDate($rcDt.toDate(), 'yyyyMMdd')}_${rcAuthor}")
      ## Build the URL used to retreive the diff viewer URL
      #set($goToDiffURL = $recentChangesDoc.getURL("view", "xpage=plain&amp;amp;action=goToDiffURL&amp;amp;page=${rcDoc.getFullName()}&amp;amp;author=${rcAuthor}&amp;amp;date=${xwiki.formatDate($rcDt.toDate(), 'yyyyMMdd')}&amp;amp;rcShowMinor=${rcShowMinor}"))
      &lt;li class="xitem xunderline xhighlight ${rcType}"&gt;
        &lt;div class="xitemcontainer"&gt;        
          #if($rcType == "comment")
            &lt;div class="modifiedPage"&gt;&lt;a href="$rcDoc.getURL()" title="$msg.get("xe.recentchanges.entry.comment.tooltip", [$xwiki.formatDate($rcDt.toDate(), "HH:mm")]) "&gt;$xwiki.getXMLEncoded($rcDoc.getDisplayTitle())&lt;/a&gt;&lt;/div&gt;
            #if($rcShowDiff)
              &lt;div class="xshowonhover modifiedPageActions"&gt;&lt;a class="ajax" href="$rcDoc.getURL("vire", "viewer=comments")" onclick="toggleClass(document.getElementById('$modGUID'), 'hidden'); toggleClass(document.getElementById('${modGUID}_comShow'), 'hidden'); toggleClass(document.getElementById('${modGUID}_comHide'), 'hidden'); return false;"&gt;&lt;span id="${modGUID}_comShow"&gt;&amp;#91;+&amp;#93; $msg.get("xe.recentchanges.entry.comment.show")&lt;/span&gt;&lt;span id="${modGUID}_comHide" class="hidden"&gt;&amp;#91;-&amp;#93; $msg.get("xe.recentchanges.entry.comment.hide")&lt;/span&gt; $msg.get("xe.recentchanges.entry.comment")&lt;/a&gt;&lt;/div&gt;
              &lt;div class="commentContainer hidden" id="$modGUID"&gt;
                &lt;div class="commentQuote lQuo"&gt;&amp;nbsp;&lt;/div&gt;
                &lt;div class="commentQuote rQuo"&gt;&amp;nbsp;&lt;/div&gt;
                &lt;div class="comment"&gt;
                  {{/html}}
                    $lastComment.get("comment")
                  {{html clean="false"}}
                &lt;/div&gt;
                ## Display discussion link, this link point to the comments anchor.
                &lt;div class="commentAdd"&gt;&lt;img src="$xwiki.getSkinFile("icons/silk/comment.gif")" alt="Reply icon" /&gt; &lt;a href="${rcDoc.getURL("view")}#Comments"&gt;$msg.get("xe.recentchanges.entry.comment.seediscussion")&lt;/a&gt;&lt;/div&gt;
              &lt;/div&gt;
            #end
          #else
            &lt;div class="modifiedPage"&gt;&lt;a href="$rcDoc.getURL()" title="$msg.get("xe.recentchanges.entry.page.tooltip", [$rcDoc.getVersion(), $xwiki.formatDate($rcDt.toDate())])"&gt;$xwiki.getXMLEncoded($rcDoc.getDisplayTitle())&lt;/a&gt; #displayRcVersion($rcDoc.getVersion())&lt;/div&gt; 
            #if($rcShowDiff)
              &lt;div class="xshowonhover modifiedPageActions"&gt;&lt;a href="$goToDiffURL" title="$msg.get('xe.recentchanges.entry.page.seemodifications.title', [$rcDoc.fullName])"&gt;$msg.get("xe.recentchanges.entry.page.seemodifications")&lt;/a&gt;&lt;/div&gt;
              ## If the author has uploaded attachments during the day in this page, display them.
              #if($rcAttachments.size() &gt; 0)              
                &lt;div class="attachmentContainer" id="$modGUID"&gt;
                  &lt;ul&gt;
                    #foreach($rcAttachment in $rcAttachments)
                      &lt;li class="attachment"&gt;&lt;a href="$rcDoc.getAttachmentURL($rcAttachment.filename)"&gt;$rcAttachment.filename&lt;/a&gt; #displayRcVersion($rcAttachment.getVersion())&lt;/li&gt;
                    #end  
                  &lt;/ul&gt;            
                &lt;/div&gt;          
              #end
            #end
          #end
          &lt;div class="xspacer"&gt;&amp;nbsp;&lt;/div&gt;
        &lt;/div&gt;                
      &lt;/li&gt;
    #end
    #set($previousAuthor = $rcAuthor)
    #set($previousDt = $rcDt)
  #end
  ## Close last row if any.
  #if($rcDocumentNames.size() &gt; 1)&lt;/ul&gt;&lt;/td&gt;&lt;/tr&gt;#end
&lt;/table&gt;
{{/html}}
##
## Rebuild URL query string
## Workaround until we fix $request.getQueryString()
## 
#set($queryString = "")
#set($paramMap = $request.getParameterMap())
#foreach($key in $paramMap.keySet())
  #foreach($value in $paramMap.get($key))
    #set($queryString = "${queryString}&amp;amp;${key}=${value}")
  #end
#end
##
## Provide links to display minor edits and RSS feed.
##
#if($xwiki.hasMinorEdit())

  {{html}}
  &lt;p class="recentChangesMoreActions"&gt;
    #if($rcShowMinor)
      &lt;a href="$xwiki.getURL($tdoc.getFullName(), "view", $queryString.replaceAll('rcShowMinor=true', ''))"&gt;&lt;img src="$xwiki.getSkinFile("icons/silk/zoom_out.gif")" alt="Hide minor icon"/&gt;$msg.get("xe.recentchanges.hideminor")&lt;/a&gt;
    #else
      &lt;a href="$xwiki.getURL($tdoc.getFullName(), "view", "${queryString}&amp;amp;rcShowMinor=true")"&gt;&lt;img src="$xwiki.getSkinFile("icons/silk/zoom_in.gif")" alt="Show minor icon"/&gt;$msg.get("xe.recentchanges.showminor")&lt;/a&gt;
    #end
    #if($rcShowRss)
      #set($rssURL = "")
      #set($parameters = 'xpage=plain&amp;amp;outputSyntax=plain')
      #if($rcTag.size() &gt; 0)
        #set($parameters = "${parameters}&amp;amp;tag=$listtool.get($rcTag, 0)")
      #end
      #if($rcSpace.size() &gt; 0)
        #set($parameters = "${parameters}&amp;amp;space=$listtool.get($rcSpace, 0)")
      #end
      #set($rssURL = $xwiki.getURL('Main.WebRss', 'view', $parameters))
      &lt;a href="${rssURL}"&gt;&lt;img src="$xwiki.getSkinFile("icons/silk/feed.gif")" alt="RSS icon"/&gt;$msg.get("xe.recentchanges.rssfeed")&lt;/a&gt;
    #end
  &lt;/p&gt;
  {{/html}}
#end
{{/velocity}}
</code></property><property><contentDescription></contentDescription></property><property><contentType>No content</contentType>
</property>
<property>
<defaultCategory>Content</defaultCategory>
</property>
<property>
<description>Displays the recent changes in this wiki or in the passed space, if any.</description>
</property>
<property>
<id>recentchanges</id>
</property>
<property>
<name>Recent Changes</name>
</property>
<property>
<supportsInlineMode>0</supportsInlineMode>
</property>
<property>
<visibility>Current Wiki</visibility>
</property>
</object>
<object>
<class>
<name>XWiki.WikiMacroParameterClass</name>
<customClass></customClass>
<customMapping></customMapping>
<defaultViewSheet></defaultViewSheet>
<defaultEditSheet></defaultEditSheet>
<defaultWeb></defaultWeb>
<nameField></nameField>
<validationScript></validationScript>
<defaultValue>
<disabled>0</disabled>
<name>defaultValue</name>
<number>4</number>
<prettyName>Parameter default value</prettyName>
<size>30</size>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.StringClass</classType>
</defaultValue>
<description>
<disabled>0</disabled>
<name>description</name>
<number>2</number>
<prettyName>Parameter description</prettyName>
<rows>5</rows>
<size>40</size>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
</description>
<mandatory>
<disabled>0</disabled>
<displayFormType>select</displayFormType>
<displayType>yesno</displayType>
<name>mandatory</name>
<number>3</number>
<prettyName>Parameter mandatory</prettyName>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
</mandatory>
<name>
<disabled>0</disabled>
<name>name</name>
<number>1</number>
<prettyName>Parameter name</prettyName>
<size>30</size>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.StringClass</classType>
</name>
</class>
<name>Main.RecentChanges</name>
<number>0</number>
<className>XWiki.WikiMacroParameterClass</className>
<guid>822b7323-43ba-4878-8209-7537c9a7c395</guid>
<property>
<defaultValue>false</defaultValue>
</property>
<property>
<description>Whether to show modifications that create minor versions or not.</description>
</property>
<property>
<mandatory>0</mandatory>
</property>
<property>
<name>showMinor</name>
</property>
</object>
<object>
<class>
<name>XWiki.WikiMacroParameterClass</name>
<customClass></customClass>
<customMapping></customMapping>
<defaultViewSheet></defaultViewSheet>
<defaultEditSheet></defaultEditSheet>
<defaultWeb></defaultWeb>
<nameField></nameField>
<validationScript></validationScript>
<defaultValue>
<disabled>0</disabled>
<name>defaultValue</name>
<number>4</number>
<prettyName>Parameter default value</prettyName>
<size>30</size>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.StringClass</classType>
</defaultValue>
<description>
<disabled>0</disabled>
<name>description</name>
<number>2</number>
<prettyName>Parameter description</prettyName>
<rows>5</rows>
<size>40</size>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
</description>
<mandatory>
<disabled>0</disabled>
<displayFormType>select</displayFormType>
<displayType>yesno</displayType>
<name>mandatory</name>
<number>3</number>
<prettyName>Parameter mandatory</prettyName>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
</mandatory>
<name>
<disabled>0</disabled>
<name>name</name>
<number>1</number>
<prettyName>Parameter name</prettyName>
<size>30</size>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.StringClass</classType>
</name>
</class>
<name>Main.RecentChanges</name>
<number>1</number>
<className>XWiki.WikiMacroParameterClass</className>
<guid>c9d7f9c0-5fe8-49e9-86c9-ba04148576d7</guid>
<property>
<defaultValue>true</defaultValue>
</property>
<property>
<description>Whether to show differences in for the items in the changes list or not.</description>
</property>
<property>
<mandatory>0</mandatory>
</property>
<property>
<name>showDiff</name>
</property>
</object>
<object>
<class>
<name>XWiki.WikiMacroParameterClass</name>
<customClass></customClass>
<customMapping></customMapping>
<defaultViewSheet></defaultViewSheet>
<defaultEditSheet></defaultEditSheet>
<defaultWeb></defaultWeb>
<nameField></nameField>
<validationScript></validationScript>
<defaultValue>
<disabled>0</disabled>
<name>defaultValue</name>
<number>4</number>
<prettyName>Parameter default value</prettyName>
<size>30</size>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.StringClass</classType>
</defaultValue>
<description>
<disabled>0</disabled>
<name>description</name>
<number>2</number>
<prettyName>Parameter description</prettyName>
<rows>5</rows>
<size>40</size>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
</description>
<mandatory>
<disabled>0</disabled>
<displayFormType>select</displayFormType>
<displayType>yesno</displayType>
<name>mandatory</name>
<number>3</number>
<prettyName>Parameter mandatory</prettyName>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
</mandatory>
<name>
<disabled>0</disabled>
<name>name</name>
<number>1</number>
<prettyName>Parameter name</prettyName>
<size>30</size>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.StringClass</classType>
</name>
</class>
<name>Main.RecentChanges</name>
<number>2</number>
<className>XWiki.WikiMacroParameterClass</className>
<guid>a50d0bbe-21f8-444d-b42f-5d521372d79e</guid>
<property>
<defaultValue>true</defaultValue>
</property>
<property>
<description>Whether to show changes rss links or not.</description>
</property>
<property>
<mandatory>0</mandatory>
</property>
<property>
<name>showRss</name>
</property>
</object>
<object>
<class>
<name>XWiki.WikiMacroParameterClass</name>
<customClass></customClass>
<customMapping></customMapping>
<defaultViewSheet></defaultViewSheet>
<defaultEditSheet></defaultEditSheet>
<defaultWeb></defaultWeb>
<nameField></nameField>
<validationScript></validationScript>
<defaultValue>
<disabled>0</disabled>
<name>defaultValue</name>
<number>4</number>
<prettyName>Parameter default value</prettyName>
<size>30</size>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.StringClass</classType>
</defaultValue>
<description>
<disabled>0</disabled>
<name>description</name>
<number>2</number>
<prettyName>Parameter description</prettyName>
<rows>5</rows>
<size>40</size>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
</description>
<mandatory>
<disabled>0</disabled>
<displayFormType>select</displayFormType>
<displayType>yesno</displayType>
<name>mandatory</name>
<number>3</number>
<prettyName>Parameter mandatory</prettyName>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
</mandatory>
<name>
<disabled>0</disabled>
<name>name</name>
<number>1</number>
<prettyName>Parameter name</prettyName>
<size>30</size>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.StringClass</classType>
</name>
</class>
<name>Main.RecentChanges</name>
<number>3</number>
<className>XWiki.WikiMacroParameterClass</className>
<guid>d5e380c7-3554-48e4-9c4d-c2ec4ca1fe7d</guid>
<property>
<defaultValue>30</defaultValue>
</property>
<property>
<description>Number of changes to show.</description>
</property>
<property>
<mandatory>0</mandatory>
</property>
<property>
<name>changesNb</name>
</property>
</object>
<object>
<class>
<name>XWiki.WikiMacroParameterClass</name>
<customClass></customClass>
<customMapping></customMapping>
<defaultViewSheet></defaultViewSheet>
<defaultEditSheet></defaultEditSheet>
<defaultWeb></defaultWeb>
<nameField></nameField>
<validationScript></validationScript>
<defaultValue>
<disabled>0</disabled>
<name>defaultValue</name>
<number>4</number>
<prettyName>Parameter default value</prettyName>
<size>30</size>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.StringClass</classType>
</defaultValue>
<description>
<disabled>0</disabled>
<name>description</name>
<number>2</number>
<prettyName>Parameter description</prettyName>
<rows>5</rows>
<size>40</size>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
</description>
<mandatory>
<disabled>0</disabled>
<displayFormType>select</displayFormType>
<displayType>yesno</displayType>
<name>mandatory</name>
<number>3</number>
<prettyName>Parameter mandatory</prettyName>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
</mandatory>
<name>
<disabled>0</disabled>
<name>name</name>
<number>1</number>
<prettyName>Parameter name</prettyName>
<size>30</size>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.StringClass</classType>
</name>
</class>
<name>Main.RecentChanges</name>
<number>4</number>
<className>XWiki.WikiMacroParameterClass</className>
<guid>9d0af90f-f2c0-4f22-b555-c20b596bb70e</guid>
<property>
<defaultValue></defaultValue>
</property>
<property>
<description>Comma separated list of tags to display changes for.</description>
</property>
<property>
<mandatory>0</mandatory>
</property>
<property>
<name>tag</name>
</property>
</object>
<object>
<class>
<name>XWiki.WikiMacroParameterClass</name>
<customClass></customClass>
<customMapping></customMapping>
<defaultViewSheet></defaultViewSheet>
<defaultEditSheet></defaultEditSheet>
<defaultWeb></defaultWeb>
<nameField></nameField>
<validationScript></validationScript>
<defaultValue>
<disabled>0</disabled>
<name>defaultValue</name>
<number>4</number>
<prettyName>Parameter default value</prettyName>
<size>30</size>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.StringClass</classType>
</defaultValue>
<description>
<disabled>0</disabled>
<name>description</name>
<number>2</number>
<prettyName>Parameter description</prettyName>
<rows>5</rows>
<size>40</size>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
</description>
<mandatory>
<disabled>0</disabled>
<displayFormType>select</displayFormType>
<displayType>yesno</displayType>
<name>mandatory</name>
<number>3</number>
<prettyName>Parameter mandatory</prettyName>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
</mandatory>
<name>
<disabled>0</disabled>
<name>name</name>
<number>1</number>
<prettyName>Parameter name</prettyName>
<size>30</size>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.StringClass</classType>
</name>
</class>
<name>Main.RecentChanges</name>
<number>5</number>
<className>XWiki.WikiMacroParameterClass</className>
<guid>cd7504db-2ea0-4969-9c80-bd5d31fc9410</guid>
<property>
<defaultValue></defaultValue>
</property>
<property>
<description>Comma separated list of spaces to display the recent changes for.</description>
</property>
<property>
<mandatory>0</mandatory>
</property>
<property>
<name>space</name>
</property>
</object>
<object>
<class>
<name>XWiki.WikiMacroParameterClass</name>
<customClass></customClass>
<customMapping></customMapping>
<defaultViewSheet></defaultViewSheet>
<defaultEditSheet></defaultEditSheet>
<defaultWeb></defaultWeb>
<nameField></nameField>
<validationScript></validationScript>
<defaultValue>
<disabled>0</disabled>
<name>defaultValue</name>
<number>4</number>
<prettyName>Parameter default value</prettyName>
<size>30</size>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.StringClass</classType>
</defaultValue>
<description>
<disabled>0</disabled>
<name>description</name>
<number>2</number>
<prettyName>Parameter description</prettyName>
<rows>5</rows>
<size>40</size>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
</description>
<mandatory>
<disabled>0</disabled>
<displayFormType>select</displayFormType>
<displayType>yesno</displayType>
<name>mandatory</name>
<number>3</number>
<prettyName>Parameter mandatory</prettyName>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
</mandatory>
<name>
<disabled>0</disabled>
<name>name</name>
<number>1</number>
<prettyName>Parameter name</prettyName>
<size>30</size>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.StringClass</classType>
</name>
</class>
<name>Main.RecentChanges</name>
<number>6</number>
<className>XWiki.WikiMacroParameterClass</className>
<guid>c0c73914-3f1a-45e2-a88a-cc8481c66abb</guid>
<property>
<defaultValue></defaultValue>
</property>
<property>
<description>Comma separated list of authors whose modifications to show.</description>
</property>
<property>
<mandatory>0</mandatory>
</property>
<property>
<name>author</name>
</property>
</object>
<content>{{velocity}}
##
## Recent changes.
##
## Optional parameters :
## 
## Parameters which can be set in velocity before including this page or can be passed as HTTP parameters.
## Note that HTTP parameters supercede velocity set variables.
##
##  - rcShowMinor (String set to "true" or "false"): show minor edits.
##  - rcShowDiff (String set to "true" or "false"): show diff in items. 
##  - rcShowRss (String set to "true" or "false"): show RSS at the bottom of the list.
##  - rcChangesNb (String set to a numerical value): number of recent changes to display. 
##  - rcSpace (List of string[s]): restrict recent changes retrieval to pages within the given space.
##  - rcTag (List of string[s]): restrict recent changes retrieval to pages with the given tag.
##  - rcAuthor (List of string[s]): restrict recent changes retrieval to pages with the given author.
##
#set($action = "$!request.getParameter('action')")
#if($action == "goToDiffURL")
  #set($page = "$!request.getParameter('page')")
  #set($author = "$!request.getParameter('author')")
  #set($date = "$!request.getParameter('date')")    
  #set($period = $xwiki.criteriaService.getPeriodFactory().createDayPeriod($date))
  #set($criterion = $xwiki.criteriaService.getRevisionCriteriaFactory().createRevisionCriteria($author, $period))
  #if("$!request.getParameter('rcShowMinor')" == "true")
    #set($discard = $criterion.setIncludeMinorVersions(true))
  #end
  #set($diffDoc = $xwiki.getDocument($page))
  #set($revisions = $diffDoc.getRevisions($criterion))
  #set($rev1 = $listtool.get($revisions, 0))
  #set($revMax = $revisions.size() - 1)
  #set($rev2 = $listtool.get($revisions, $revMax))
  #if($rev2 != "1.1")
    #set($rev2 = $xwiki.getDocument($diffDoc, $rev2).getPreviousVersion())
  #end
  $response.sendRedirect($diffDoc.getURL("view", "viewer=changes&amp;rev1=${rev1}&amp;rev2=${rev2}"))
#end
#if($rcTag)
  #set($rcTagString = "")
  #foreach($rcTagValue in $rcTag)
    #if($velocityCount &gt; 1)
      #set($rcTagString = "${rcTagString}, ")
    #end
    #set($rcTagString = "${rcTagString} ${rcTagValue}")
  #end
#end
#if($rcSpace)
  #set($rcSpaceString = "")
  #foreach($rcSpaceValue in $rcSpace)
    #if($velocityCount &gt; 1)
      #set($rcSpaceString = "${rcSpaceString}, ")
    #end
    #set($rcSpaceString = "${rcSpaceString} ${rcSpaceValue}")
  #end
#end
#if($rcAuthor)
  #set($rcAuthorString = "")
  #foreach($rcAuthorValue in $rcAuthor)
    #if($velocityCount &gt; 1)
      #set($rcAuthorString = "${rcAuthorString}, ")
    #end
    #set($rcAuthorString = "${rcAuthorString} ${rcAuthorValue}")
  #end
#end
## pass the variables from the velocity context
{{recentchanges #if($rcShowMinor) showMinor="$rcShowMinor" #end
                #if($rcShowDiff) showDiff="$rcShowDiff" #end
                #if($rcShowRss) showRss="$rcShowRss" #end 
                #if($rcChangesNb) changesNb="$rcChangesNb" #end
                #if($rcSpaceString) space="$rcSpaceString" #end
                #if($rcTagString) tag="$rcTagString" #end 
                #if($rcAuthorString) author="$rcAuthorString" #end /}}
{{/velocity}}</content>
</xwikidoc>
