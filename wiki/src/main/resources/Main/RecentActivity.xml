<?xml version="1.0" encoding="UTF-8"?>
<xwikidoc>
<web>Main</web>
<name>RecentActivity</name>
<language></language>
<defaultLanguage>en</defaultLanguage>
<translation>0</translation>
<parent>Main.Dashboard</parent>
<creator>XWiki.Admin</creator>
<author>XWiki.Admin</author>
<customClass></customClass>
<contentAuthor>XWiki.Admin</contentAuthor>
<creationDate>1252458000000</creationDate>
<date>1287582416000</date>
<contentUpdateDate>1287582416000</contentUpdateDate>
<version>1.1</version>
<title>$msg.get("xe.recentactivity")</title>
<template></template>
<defaultTemplate></defaultTemplate>
<validationScript></validationScript>
<comment></comment>
<minorEdit>false</minorEdit>
<syntaxId>xwiki/2.0</syntaxId>
<hidden>false</hidden>
<object>
<class>
<name>XWiki.JavaScriptExtension</name>
<customClass></customClass>
<customMapping></customMapping>
<defaultViewSheet></defaultViewSheet>
<defaultEditSheet></defaultEditSheet>
<defaultWeb></defaultWeb>
<nameField></nameField>
<validationScript></validationScript>
<cache>
<cache>0</cache>
<disabled>0</disabled>
<displayType>select</displayType>
<multiSelect>0</multiSelect>
<name>cache</name>
<number>5</number>
<prettyName>Caching policy</prettyName>
<relationalStorage>0</relationalStorage>
<separator> </separator>
<separators> ,|</separators>
<size>1</size>
<unmodifiable>0</unmodifiable>
<values>long|short|default|forbid</values>
<classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
</cache>
<code>
<disabled>0</disabled>
<name>code</name>
<number>2</number>
<prettyName>Code</prettyName>
<rows>20</rows>
<size>50</size>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
</code>
<name>
<disabled>0</disabled>
<name>name</name>
<number>1</number>
<prettyName>Name</prettyName>
<size>30</size>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.StringClass</classType>
</name>
<parse>
<disabled>0</disabled>
<displayFormType>select</displayFormType>
<displayType>yesno</displayType>
<name>parse</name>
<number>4</number>
<prettyName>Parse content</prettyName>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
</parse>
<use>
<cache>0</cache>
<disabled>0</disabled>
<displayType>select</displayType>
<multiSelect>0</multiSelect>
<name>use</name>
<number>3</number>
<prettyName>Use this extension</prettyName>
<relationalStorage>0</relationalStorage>
<separator> </separator>
<separators> ,|</separators>
<size>1</size>
<unmodifiable>0</unmodifiable>
<values>currentPage=Always on this page|onDemand=On demand|always=Always on this wiki</values>
<classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
</use>
</class>
<name>Main.RecentActivity</name>
<number>0</number>
<className>XWiki.JavaScriptExtension</className>
<guid>5c505c61-ae77-44de-b1b0-f9fcaca3b2b6</guid>
<property>
<cache>long</cache>
</property>
<property>
<code>// Make sure the XWiki 'namespace' exists.
if (typeof(XWiki) == 'undefined') {
  XWiki = new Object();
}

XWiki.RecentActivity = Class.create({
  initialize : function() {
    this.initHandlers();
  },
  initHandlers: function() {
    $$('.activityHeader').each(function(activityHeader){
      if(activityHeader.up().hasClassName('collapsed')){
        activityHeader.observe('click', this.toggle.bind(this, activityHeader.up()));
      }
    }.bind(this));
  },
  toggle: function() {
    var collapsable = arguments[0];
    if (collapsable.hasClassName('collapsed')) {
      collapsable.removeClassName('collapsed');
      collapsable.down('.toolExpand').update('&amp;#9650;');
    } else {
      collapsable.addClassName('collapsed');
      collapsable.down('.toolExpand').update('&amp;#9660;');
    }
  }
});
document.observe('xwiki:dom:loaded', function() {
  new XWiki.RecentActivity();
});</code>
</property>
<property>
<name>Expand and Collapse</name>
</property>
<property>
<parse></parse>
</property>
<property>
<use>onDemand</use>
</property>
</object>
<object>
<class>
<name>XWiki.StyleSheetExtension</name>
<customClass></customClass>
<customMapping></customMapping>
<defaultViewSheet></defaultViewSheet>
<defaultEditSheet></defaultEditSheet>
<defaultWeb></defaultWeb>
<nameField></nameField>
<validationScript></validationScript>
<cache>
<cache>0</cache>
<disabled>0</disabled>
<displayType>select</displayType>
<multiSelect>0</multiSelect>
<name>cache</name>
<number>5</number>
<prettyName>Caching policy</prettyName>
<relationalStorage>0</relationalStorage>
<separator> </separator>
<separators> ,|</separators>
<size>1</size>
<unmodifiable>0</unmodifiable>
<values>long|short|default|forbid</values>
<classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
</cache>
<code>
<disabled>0</disabled>
<name>code</name>
<number>2</number>
<prettyName>Code</prettyName>
<rows>20</rows>
<size>50</size>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
</code>
<name>
<disabled>0</disabled>
<name>name</name>
<number>1</number>
<prettyName>Name</prettyName>
<size>30</size>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.StringClass</classType>
</name>
<parse>
<disabled>0</disabled>
<displayFormType>select</displayFormType>
<displayType>yesno</displayType>
<name>parse</name>
<number>4</number>
<prettyName>Parse content</prettyName>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
</parse>
<use>
<cache>0</cache>
<disabled>0</disabled>
<displayType>select</displayType>
<multiSelect>0</multiSelect>
<name>use</name>
<number>3</number>
<prettyName>Use this extension</prettyName>
<relationalStorage>0</relationalStorage>
<separator> </separator>
<separators> ,|</separators>
<size>1</size>
<unmodifiable>0</unmodifiable>
<values>currentPage=Always on this page|onDemand=On demand|always=Always on this wiki</values>
<classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
</use>
</class>
<name>Main.RecentActivity</name>
<number>0</number>
<className>XWiki.StyleSheetExtension</className>
<guid>ab40f34b-0de4-4e6a-a6c8-f03dce1d6db5</guid>
<property>
<cache>default</cache>
</property>
<property>
<code>#template('colorThemeInit.vm')

.rssURL{
  padding-top: 5px;
  text-align: right;
}

ul.activityList {
  list-style: none;
  margin: 0;
}

.activityItem {
  margin: 0 0 5px;
  padding: 5px 0;
  position: relative;
}

.activityItem .activityItem {
  margin: 0;
}

.activityPage:hover , .activityApplication:hover , .activityUser:hover {
  background: $theme.highlightColor;
}

.activityApplication, .activityUser, .activityPage .activityItem {
  display: block;
  padding-left: 75px;
  position: relative;
}

.activitySummary {
  min-height: 35px;
  padding-top: 5px;
}

.activitySummary , .activityPage .activityAction {
  padding-left: 25px;
}

.activityPage ul .activityAction {
  padding-left: 0;
}

.activityAuthor , .activityAction{
  display: block;
}

.activityAction, .activityTime {
  color: $theme.textSecondaryColor;
  font-size: .8em;
}

.activityTime {
  padding: 5px 15px 0 0;
  position: absolute;
  right: 0;
  top: 0;
}

.activitySnapshot {
  height: 30px;
  left: 0;
  margin: 5px 0 0 25px;
  position: absolute;
}

.activitySummary .activitySnapshot {
  display: inline-block;
  margin: 0 17px 0 0;
  position: relative;
}

.activityItem .activityItem .activitySnapshot {
  margin-top: 2px;
}

.activitySnapshot img {
  height: 30px;
  width: 30px;
}

.activitySnapshot .activityActionAvatar{
  background: #F9F9F9;
  border-color: #F9F9F9;
  border-style: solid;
  border-width: 4px 1px 1px 3px;
  bottom: -5px;
  height :16px;
  position: absolute;
  right: -10px;
  width: 16px;
}

/** &lt;start&gt; Inside activityContent **/
.activityApplication .activityContent,
.activityUser .activityContent,
.activityList .annotated,
.activityList .annotation,
.activityList .attachment,
.activityList .comment {
  font-size: .9em;
  padding-right: 15px;
}

.collapsed .activityContent, .activitySummary {
  display: none;
}

.collapsed .activitySummary {
  display: block;
}

.activityList .annotated {
  background-color: #FFEE99;
  padding: 3px 15px 3px 5px;
}

.activityList .attachment {
  padding: 3px 0 0;
}
/** &lt;end&gt; **/

/** &lt;start&gt; Tools **/
/** &lt;start&gt; Expand Tool **/
.toolExpand{
  color: $theme.textColor;
  cursor: pointer;
  font-size: .6em;
  padding: 0 3px;
  position: absolute;
  right: 0;
  top: 7px;
  visibility: hidden;
}

.toolExpand:hover {
  text-decoration: none;
}

.activityList:hover .toolExpand  {
  visibility: visible;
}
/** &lt;end&gt; Expand Tool **/
/** &lt;start&gt; Filter Tool **/
.toolFilter {
  cursor: pointer;
  float: right;
  padding-right: 13px;
  position: relative;
}

.toolFilter .toolExpand{
  color: transparent;
}

h1:hover .toolFilter .toolExpand {
  color: $theme.textColor;
}

.toolFilter  .toolExpand {
  font-size: 0.3em;
  line-height: 4em;
  top: 5px;
}
/** &lt;/end&gt; Filter Tool **/
/** &lt;/end&gt; Tools **/

/** &lt;start&gt; Action Types **/
.type {
  background: none no-repeat scroll 4px 0 transparent;
  padding-left: 25px;
}

.typePage {
  background-image:url("$xwiki.getSkinFile('icons/silk/page_white_text.gif')");
}

/** &lt;/end&gt; Action Types **/

/** CSS 3**/
.activityPage, .activityApplication, .activityUser {
  background-color: #FDFDFD;
  background-image: -moz-linear-gradient(top, #FFFFFF, #FAFAFA); /* FF3.5+ */
  background-image: -webkit-gradient(linear,left top,left bottom,color-stop(0, #FFFFFF),color-stop(1, #FAFAFA)); /* Saf4+, Chrome */
  filter:  progid:DXImageTransform.Microsoft.gradient(startColorStr='#FFFFFF', EndColorStr='#FAFAFA'); /* IE6,IE7 */
  -ms-filter: "progid:DXImageTransform.Microsoft.gradient(startColorStr='#FFFFFF', EndColorStr='#FAFAFA')"; /* IE8 */
}

.activityPage:hover , .activityApplication:hover , .activityUser:hover {
  filter: none;
}

.activitySnapshot .activityActionAvatar {
  -moz-border-radius: 10px 10px 0 10px; /* FF1+ */
  -webkit-border-radius: 10px 10px 0 10px; /* Saf3-4*/
  border-radius: 10px 10px 0 10px; /* Opera 10.5, IE 9, Saf5, Chrome */
  -moz-box-shadow: -1px 1px 1px rgba(100, 100, 100, 0.8); /* FF3.5+ */
  -webkit-box-shadow: -1px 1px 1px rgba(100, 100, 100, 0.8); /* Saf3+, Chrome */
  box-shadow: -1px 1px 1px rgba(100, 100, 100, 0.8); /* Opera 10.5, IE 9 */
}

.activitySnapshot img {
  -moz-box-shadow:0 0 1px rgba(100, 100, 100, 0.8); /* FF3.5+ */
  -webkit-box-shadow: -1px 1px 1px rgba(100, 100, 100, 0.8); /* Saf3+, Chrome */
  box-shadow: -1px 1px 1px rgba(100, 100, 100, 0.8); /* Opera 10.5, IE 9 */
}

/** IE6, IE7 **/
* html ul.activityList  {
  list-style-position: outside; /* IE6 */
}

* html .activityItem ,  * html  .activityHeader, * html  .activityContent ul{
  display: inline-block;
}

* html .activityAuthor {
  float: left;
}
*+html .activityAuthor {
  float: left;
}

* html .activityTime {
  float: right;
}

* html .activityItem {
  float: right;
}

* html .activityContent {
  line-height: 1%;
}

* html .activityAction {
  clear: left;
}

* html .activitySummary {
  height: 40px; /* IE 6 */
}
</code></property><property><name>Recent Activity CSS</name>
</property>
<property>
<parse>1</parse>
</property>
<property>
<use>onDemand</use>
</property>
</object>
<object>
<class>
<name>XWiki.WikiMacroClass</name>
<customClass></customClass>
<customMapping></customMapping>
<defaultViewSheet></defaultViewSheet>
<defaultEditSheet></defaultEditSheet>
<defaultWeb></defaultWeb>
<nameField></nameField>
<validationScript></validationScript>
<code>
<disabled>0</disabled>
<name>code</name>
<number>9</number>
<prettyName>Macro code</prettyName>
<rows>20</rows>
<size>40</size>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
</code>
<contentDescription>
<disabled>0</disabled>
<name>contentDescription</name>
<number>8</number>
<prettyName>Content description (Not applicable for "No content" type)</prettyName>
<rows>5</rows>
<size>40</size>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
</contentDescription>
<contentType>
<cache>0</cache>
<disabled>0</disabled>
<displayType>select</displayType>
<multiSelect>0</multiSelect>
<name>contentType</name>
<number>7</number>
<prettyName>Macro content type</prettyName>
<relationalStorage>0</relationalStorage>
<separator>|</separator>
<separators>|</separators>
<size>1</size>
<unmodifiable>0</unmodifiable>
<values>Mandatory|Optional|No content</values>
<classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
</contentType>
<defaultCategory>
<disabled>0</disabled>
<name>defaultCategory</name>
<number>4</number>
<prettyName>Default category</prettyName>
<size>30</size>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.StringClass</classType>
</defaultCategory>
<description>
<disabled>0</disabled>
<name>description</name>
<number>3</number>
<prettyName>Macro description</prettyName>
<rows>5</rows>
<size>40</size>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
</description>
<id>
<disabled>0</disabled>
<name>id</name>
<number>1</number>
<prettyName>Macro id</prettyName>
<size>30</size>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.StringClass</classType>
</id>
<name>
<disabled>0</disabled>
<name>name</name>
<number>2</number>
<prettyName>Macro name</prettyName>
<size>30</size>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.StringClass</classType>
</name>
<supportsInlineMode>
<disabled>0</disabled>
<displayFormType>select</displayFormType>
<displayType>yesno</displayType>
<name>supportsInlineMode</name>
<number>5</number>
<prettyName>Supports inline mode</prettyName>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
</supportsInlineMode>
<visibility>
<cache>0</cache>
<disabled>0</disabled>
<displayType>select</displayType>
<multiSelect>0</multiSelect>
<name>visibility</name>
<number>6</number>
<prettyName>Macro visibility</prettyName>
<relationalStorage>0</relationalStorage>
<separator>|</separator>
<separators>|</separators>
<size>1</size>
<unmodifiable>0</unmodifiable>
<values>Current User|Current Wiki|Global</values>
<classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
</visibility>
</class>
<name>Main.RecentActivity</name>
<number>0</number>
<className>XWiki.WikiMacroClass</className>
<guid>8891cf6c-541d-4e15-8986-ca230207525e</guid>
<property>
<code>{{velocity output=false}}
##
##
## Skin Extensions
##--------------------------------------------------------------
$xwiki.jsx.use("Main.RecentActivity")##
$xwiki.ssx.use("Main.RecentActivity")##
##
## Icons
##--------------------------------------------------------------
## some events are not implemented yet in the activitystream plugin: TODO: application | activityApplication, user | activityUser
#set($activityActionsMap = {
  'create':           'icons/silk/page_white_add.gif',
  'delete':           'icons/silk/page_white_delete.gif',
  'update':           'icons/silk/page_white_edit.gif',
  'addAnnotation':    'icons/silk/note_add.gif',
  'deleteAnnotation': 'icons/silk/note_delete.gif',
  'updateAnnotation': 'icons/silk/note_edit.gif',
  'addAttachment':    'icons/xwiki/attach_add.png',
  'deleteAttachment': 'icons/xwiki/attach_delete.png',
  'updateAttachment': 'icons/xwiki/attach_edit.png',
  'addComment':       'icons/silk/comment_add.gif',
  'deleteComment':    'icons/silk/comment_delete.gif',
  'updateComment':    'icons/silk/comment_edit.gif'
})
##
## Date Time
##--------------------------------------------------------------
#set($currentTime = $xwiki.jodatime.getDateTime())
#set($now = $datetool.date)
#set($todayYear = $datetool.getYear($now))
#set($todayMonth = $datetool.getMonth($now) + 1)
#set($todayMidnight = $currentTime.toDateMidnight())
#set($yesterdayMidnight = $todayMidnight.minusDays(1))
##
## Formatters
##--------------------------------------------------------------
#set($eventDateFormatter = 'dd MMM, HH:mm')
#set($eventFullDateFormatter = 'yyyy/MM/dd HH:mm')
#set($activityListDateFormatter = 'dd MMM')
##
## Filter clause
##--------------------------------------------------------------
#set($filterClause = '1=1')
##
## Get values from request/macro param
##--------------------------------------------------------------
## Authors
#setVariableFromRequest($rcAuthor "rcAuthor" [])
#if($rcAuthor.size() == 0)
  #set($rcAuthorString = $context.macro.params.get('author'))
  #asList($rcAuthor $rcAuthorString)
#end
## Spaces
#setVariableFromRequest($rcSpace "rcSpace" [])
#if($rcSpace.size() == 0)
  #set($rcSpaceString = $context.macro.params.get('space'))
  #asList($rcSpace $rcSpaceString)
#end
## Tags
#setVariableFromRequest($rcTag "rcTag" [])
#if($rcTag.size() == 0)
  #set($rcTagString = $context.macro.params.get('tag'))
  #asList($rcTag $rcTagString)
#end
## RSS links
#setVariableFromRequest($rcShowRss "rcShowRss" false)
## Number of pages to display
#setVariableFromRequest($rcChangesNb "rcChangesNb" 20)
## Number of events for each page
#setVariableFromRequest($rcEventsNo "rcEventsNo" 10)
##
## Filter by
## ------------------------------------------------------------
## AUTHOR
#updateFilterClause('user' $rcAuthor false)
## SPACE
#updateFilterClause('space' $rcSpace false)
## BLACKLISTED SPACES - exclude them
#if($blacklistedSpaces)
  #updateFilterClause('space' $blacklistedSpaces true)
#end
## TAGS
#if("$!xwiki.getPlugin('tag')" != "" &amp;&amp; $rcTag.size() &gt; 0)
  #set($docsWithTag = $util.getArrayList())
  #foreach($item in $rcTag)
    #set($discard = $docsWithTag.addAll($xwiki.tag.getDocumentsWithTag($item)))
  #end
  #updateFilterClause('page' $docsWithTag false)
#end
##
## Macros
## -------------------------------------------------------------
#*
 * Gets the list (java.util.List) of elements in $arrayAsString, and puts them in the $list.
 *
 * @param $arrayAsString the string form of the array, similar to the java syntax for a macro ({elt1, elt2, etc}), or without the {}
 * @param $list the variable to put the resulted list into. It will be (re)initialized and emptied by this macro
 * FIXME: this is gonna fail for lists with '{' in the string or ','. Need to escape
 *#
#macro(asList $list $arrayAsString)
  #if("$!arrayAsString" != "")
    #set($list = [])
    ## if the string is surrounded by {}, eliminate and then parse as list
    #if($arrayAsString.startsWith('{') &amp;&amp; $arrayAsString.endWith('}'))
      #set($endIndex = $arrayAsString.length() - 1)
      #set($arrayAsString = $arrayAsString.substring(1, $endIndex))
    #end
    ## parse the array serialized as string and fill in the list
    #set($valuesArray = $arrayAsString.split(","))
    #foreach($value in $valuesArray)
      #if($value.trim().length())
        #set($dispose = $list.add($value.trim()))
      #end
    #end
  #end
#end
#**
  * Build query filter clause
  * @colName The name of the collumn in the database table
  * @colValues The values to match with
  * @exclude If true, exclude the given column values
  *#
#macro(updateFilterClause $colName $colValues $exclude)
  #if($colValues.class == 'class java.lang.String')
    #set($filterClause = $filterClause + " and ${colName}='" + ${colValues} + "'")
  #else
    #foreach($colValue in $colValues)
      #if($velocityCount == 1)
        #set($filterCondition = 'in')
        #if($exclude)
          #set($filterCondition = 'not ' + $filterCondition)
        #end
        #set($filterClause = $filterClause + " and ${colName} ${filterCondition} (")
      #end
      #if("$!colValues" != '')
        #if($velocityCount &gt; 1) #set($filterClause = $filterClause + ',') #end
        #set($filterClause = $filterClause + "'" + $colValue + "'")
      #end
      #if($velocityCount == $colValues.size())
         #set($filterClause = $filterClause + ')')
      #end
    #end
  #end
#end
#**
  * Check if the current page event list entry is expandable (there are at least 2 events for the current page) or not.
  *#
#macro(isPageEntryExpandable)
  #set($isPageEntryExpandable = false)
  #if($events.size() &gt; 1)
    #set($isPageEntryExpandable = true)
  #end
#end
#**
  * Get unique page event users
  * -&gt; used to display the message: 'X changes by Y user(s)'
  *#
#macro(getUniqueEventUsers)
  #set($eventUsers = $util.arrayList)
  #foreach($event in $events)
    #if(!$eventUsers.contains($xwiki.getUserName($event.user)))
      #set($discard = $eventUsers.add($xwiki.getUserName($event.user)))
    #end
  #end
#end
#**
  * Check if the current page event happen today
  *#
#macro(isToday)
  #set($isToday = false)
  #set($timeAgoMsg = '')
  #if($mathtool.sub($eventTimeDiff.getDayOfYear(), 1) == 0 &amp;&amp;
      ($eventDateTime.isAfter($todayMidnight) ||
       $eventDateTime.isEqual($todayMidnight)
      ))
    #if($mathtool.sub($eventTimeDiff.getHourOfDay(), 2) == 0)
      ##
      ## Few seconds ago
      ## ---------------------------------------------------------------
      #set($timeAgoMsg = $msg.get('timeAgo.minutesAgo', [$eventTimeDiff.getMinuteOfHour()]))
    #else
      ##
      ## Number of minutes ago
      ## ---------------------------------------------------------------
      #set($hoursAgo = $eventTimeDiff.getHourOfDay() - 2)
      #set($timeAgoMsg = $msg.get('timeAgo.hoursAgo', [$hoursAgo]))
    #end
    #set($isToday = true)
  #end
#end
#**
  * Check if the current page event happen yesterday
  *#
#macro(isYesterday)
  #set($isYesterday = false)
  #if(($mathtool.sub($eventTimeDiff.getDayOfYear(), 1) == 0 &amp;&amp;
      $eventDateTime.isBefore($todayMidnight)
      ) ||
      ($mathtool.sub($eventTimeDiff.getDayOfYear(), 2) == 0 &amp;&amp;
      ($eventDateTime.isAfter($yesterdayMidnight) ||
       $eventDateTime.isEqual($yesterdayMidnight)
      )))
    #set($isYesterday = true)
  #end
#end
#**
  * Check if the current event is of type 'addAttachment' or 'updateAttachment' or 'deleteAttachment'
  * @param event The current event
  *#
#macro(isAttachmentEvent $event)
  #set($isAttachmentEvent = false)
  #if($event.type == 'addAttachment' || $event.type == 'updateAttachment' || $event.type == 'deleteAttachment')
    #set($isAttachmentEvent = true)
  #end
#end
#**
  * Check if the current event is of type 'addComment' or 'updateComment' or 'deleteComment'
  *#
#macro(isCommentEvent)
  #set($isCommentEvent = false)
  #if($event.type == 'addComment' || $event.type == 'updateComment' || $event.type == 'deleteComment')
    #set($isCommentEvent = true)
  #end
#end
#**
  * Check if the current event is of type 'addAnnotation' or 'updateAnnotation' or 'deleteAnnotation'
  *#
#macro(isAnnotationEvent)
  #set($isAnnotationEvent = false)
  #if($event.type == 'addAnnotation' || $event.type == 'updateAnnotation' || $event.type == 'deleteAnnotation')
    #set($isAnnotationEvent = true)
  #end
#end
#**
  * Remove duplicated 'update' and 'addAttachment' events for the current page entry
  * NOTE: each time an event != 'update' (like 'addAttachment, updateComment' ...) is fired, an extra 'update' event is fired too (for backward compatibility reasons)
  *#
#macro(removeDuplicatedEvents)
  ## TO DO - fix XWIKI-5632
  ## Because of this issue, related 'updateAnnotation' events are not included in the list (for flooding reasons)
  #set($newList = $util.arrayList)
  #set($previousEventInOldList = $util.null)
  #set($previousEventInNewList = $util.null)
  #foreach($event in $events)
    #set($hasRelatedEvents = false)
    #set($isUpdateOrAddAttachmentRelatedEvent = false)
    #set($isAnnotationUpdateRelatedEvent = false) ## TO DO - remove this variable after fixing XWIKI-5632
    #set($isConsecutiveUpdateEvent = false)
    #set($isRelatedAttachmentEvent = false)
    ##
    ## Get consecutive 'update' events having the same user (-&gt; only the latest such event will be taken in account)
    ## ---------------------------------------------------------------
    #if($event.requestId != $previousEventInNewList.requestId &amp;&amp;
       $event.type == 'update' &amp;&amp;
       $event.type == $previousEventInNewList.type &amp;&amp;
       $xwiki.getUserName($event.user) == $xwiki.getUserName($previousEventInNewList.user))
          #set($isConsecutiveUpdateEvent = true)
    #end
    ##
    ## TO DO - remove this test after fixing XWIKI-5632
    ## ---------------------------------------------------------------
    #if($xwiki.activitystream.getRelatedEvents($event).size() &gt; 1)
      #foreach($relatedEvent in $xwiki.activitystream.getRelatedEvents($event))
        #if($relatedEvent.type == 'updateAnnotation')
          #set($isAnnotationUpdateRelatedEvent = true)
        #end
      #end
    #end
    ##
    ## Get related events of type 'update' (all these events will be ignored)
    ## TO DO - remove (!$isAnnotationUpdateRelatedEvent || $event.requestId == $previousEventInNewList.requestId) from this test after fixing XWIKI-5632
    ## ---------------------------------------------------------------
    #if($xwiki.activitystream.getRelatedEvents($event).size() &gt; 1 &amp;&amp;
        (($event.type == 'update' &amp;&amp; (!$isAnnotationUpdateRelatedEvent || $event.requestId == $previousEventInNewList.requestId)) ||
        ($event.type == 'addAttachment' &amp;&amp; $event.requestId == $previousEventInNewList.requestId)))
        #set($isUpdateOrAddAttachmentRelatedEvent = true)
    #end
    ##
    ## Build the clean event list
    ## ---------------------------------------------------------------
    #if(!$isConsecutiveUpdateEvent &amp;&amp; !($event.type == 'updateAnnotation') &amp;&amp; !$isUpdateOrAddAttachmentRelatedEvent &amp;&amp; $newList.size() &lt; $rcEventsNo)
      #set($discard = $newList.add($event))
      #set($previousEventInNewList = $event)
    #end
    #set($previousEventInOldList = $event)
  #end
  ## Set the $events reference to the new list
  #set($events = $newList)
#end
#**
  * Initialize event variables
  *#
#macro(initializeEvent)
  #set($yearMsg = '')
  #set($timeAgoMsg = '')
  #set($eventDateTime = $xwiki.jodatime.getDateTime($event.date.getTime()))
  #set($eventTimeDiff = $currentTime.minus($eventDateTime.millis))
  #set($eventYear = $eventDateTime.year)
  #if($eventYear != $todayYear)
    #set($yearMsg = $eventYear)
  #end
  #isToday()
  #isYesterday()
  #isCommentEvent()
  #isAnnotationEvent()
  #if("$!timeAgoMsg" == '')
    #set($timeAgoMsg = $xwiki.formatDate($event.date, $eventDateFormatter) + " $!yearMsg")
  #end
  #set($iterationDate = $xwiki.formatDate($event.date, $activityListDateFormatter) + " $!yearMsg")
  #set($eventFullDate = $xwiki.formatDate($event.date, $eventFullDateFormatter) + " $!yearMsg")
#end
#**
  * Display the arrow used to expand the event list
  *#
#macro(toolExpand)
  &lt;a class='toolExpand'&gt;&amp;#9660;&lt;/a&gt;
#end
#**
  * Display RSS URL
  *#
#macro(displayRSSURL)
  #set($rssURL = "")
  #set($parameters = 'xpage=plain&amp;outputSyntax=plain')
  #if($rcTag.size() &gt; 0)
    #set($parameters = "${parameters}&amp;tag=$listtool.get($rcTag, 0)")
  #end
  #if($rcSpace.size() &gt; 0)
    #set($parameters = "${parameters}&amp;space=$listtool.get($rcSpace, 0)")
  #end
  #set($rssURL = $xwiki.getURL('Main.WebRss', 'view', $parameters))
  &lt;div class="rssURL"&gt;
    &lt;a href="${rssURL}"&gt;&lt;img src="$xwiki.getSkinFile("icons/silk/feed.gif")" alt="RSS icon"/&gt;$msg.get("xe.recentactivity.rssfeed")&lt;/a&gt;
  &lt;/div&gt;
#end
#**
  * Display mimetype and name for the given event of type attachment
  *#
#macro(displayAttachment $event)
  #set($pageDoc = $xwiki.getDocument($event.page))
  #set($attach = $pageDoc.getAttachment($event.param2))
  &lt;div class="attachment"&gt;
    #mimetypeimg($attach.getMimeType().toLowerCase() $event.param2)
    #if($attach.version)
      &lt;a href="$pageDoc.getAttachmentURL($event.param2)"&gt;$!event.param2&lt;/a&gt;
    #else
      $!event.param2
    #end
  &lt;/div&gt;
#end
#**
  * Display comment
  *#
#macro(displayComment $event)
  #set($pageDoc = $xwiki.getDocument($event.page))
  #set($pageDocRevision = $pageDoc.getDocumentRevision($event.version))
  &lt;div class="comment"&gt;
    $!pageDocRevision.getObject('XWiki.XWikiComments', $util.parseInt($event.getParam2())).getProperty('comment').value
  &lt;/div&gt;
#end
#**
  * Display comment
  *#
#macro(displayAnnotation $event)
  &lt;div class="annotated"&gt;$xwiki.getDocument($event.page).getObject('AnnotationCode.AnnotationClass', $util.parseInt($event.param2)).getProperty('selection').value&lt;/div&gt;
  &lt;div class="annotation"&gt;$xwiki.getDocument($event.page).getObject('AnnotationCode.AnnotationClass', $util.parseInt($event.param2)).getProperty('annotation').value&lt;/div&gt;
#end
#**
  * Display user avatar and action message
  *#
#macro(activitySnapshot $eventUser $eventType)
  &lt;span class="activitySnapshot"&gt;
    #if($eventUser != 'XWiki.XWikiGuest')
      &lt;a href="$xwiki.getURL($eventUser)"&gt;#smallUserAvatar("$!eventUser")&lt;/a&gt;
    #else
      #smallUserAvatar("$!eventUser")
    #end
    &lt;img class="activityActionAvatar" src="$xwiki.getSkinFile($activityActionsMap.get($eventType), true)" alt="$msg.get("xe.recentactivity.action.${eventType}", [$relatedEventsNo])" title="$msg.get("xe.recentactivity.action.${eventType}", [$relatedEventsNo])" /&gt;
  &lt;/span&gt;
#end
#macro(displayActivityListItemSummary)
  &lt;div class="activitySummary"&gt;
    #foreach($event in $events)
      #set($relatedEventsNo = $xwiki.activitystream.getRelatedEvents($event).size() / 2)
      #activitySnapshot($event.user $event.type)
    #end
  &lt;/div&gt;
#end
#macro(displayEventContent)
  #set($isEventEntryExpandable = false)
  #isAttachmentEvent($event)
  #if($isAnnotationEvent)
    #set($annotationObj = $xwiki.getDocument($event.page).getObject('AnnotationCode.AnnotationClass', $util.parseInt($event.param2)))
    #set($selection = $annotationObj.getProperty('selection').value)
    #set($annotation = $annotationObj.getProperty('annotation').value)
    #if("$!selection" != '' &amp;&amp; "$!annotation" != '')
      #set($isEventEntryExpandable = true)
    #end
  #end
  &lt;li class="activityItem #if($isAttachmentEvent || ($isCommentEvent &amp;&amp; $event.type != 'deleteComment') || $isEventEntryExpandable) collapsed #end"&gt;
    #if($isAttachmentEvent || ($isCommentEvent &amp;&amp; $event.type != 'deleteComment'))
      #set($isEventEntryExpandable = true)
    #end
    #displayActivityListItemHeader(false false $isEventEntryExpandable)
    &lt;div class="activityContent"&gt;
      #foreach($event in $xwiki.activitystream.getRelatedEvents($event))
        #isAttachmentEvent($event)
        #if($isAttachmentEvent)
          #displayAttachment($event)
        #end
      #end
      #if($isCommentEvent &amp;&amp; $event.type != 'deleteComment')
        #displayComment($event)
      #elseif($isAnnotationEvent &amp;&amp; $isEventEntryExpandable)
        #displayAnnotation($event)
      #end
    &lt;/div&gt;
  &lt;/li&gt;
  #set($previousEventType = $event.type)
  #set($previousEventUser = $event.user)
#end
#**
  * Display the header structure for the given event
  * @param isPageEntryExpandable if true, the curent item is expandable
  * @param isFirstEntry if true, the current item is the first entry of a list formed by a single event -&gt; do not display user avatar
  *#
#macro(displayActivityListItemHeader $isPageEntryExpandable $isFirstEntry $isEventEntryExpandable)
  #set($relatedEventsNo = $xwiki.activitystream.getRelatedEvents($event).size() / 2)
  &lt;div class="activityHeader"&gt;
    #if(!$isPageEntryExpandable &amp;&amp; !$isFirstEntry)
      #activitySnapshot($event.user $event.type)
    #end
    &lt;span class="activityAuthor"&gt;
      #if($isFirstEntry)
        &lt;a href="$xwiki.getURL($pageName)" class="typePage type"&gt;$!{escapetool.xml($xwiki.getDocument($!pageName).displayTitle)}&lt;/a&gt;
      #else
        $xwiki.getUserName($!event.user)
      #end
    &lt;/span&gt;
    #if(!$isFirstEntry || $isPageEntryExpandable)
      &lt;span class="activityAction"&gt;
        #isAttachmentEvent($event)
        #if($isPageEntryExpandable) ## display entry summary
          $!msg.get('xe.recentactivity.action.summary', [$events.size(), $eventUsers.size()])
        #else
          $!msg.get("xe.recentactivity.action.${event.type}", [$relatedEventsNo])
          #if($event.type == 'update' &amp;&amp; $event.version != '1.1')
            #set($previousVersion = $xwiki.getDocument($xwiki.getDocument($event.page), $event.version).getPreviousVersion())
            &amp;#183; &lt;a href="$xwiki.getDocument($event.page).getURL('view', "viewer=changes&amp;rev1=${previousVersion}&amp;rev2=${event.version}")"&gt;$msg.get('xe.recentactivity.action.seechanges')&lt;/a&gt;
          #end
        #end
      &lt;/span&gt;
    #end
    #if ("$!timeAgoMsg" != '')
      &lt;span class='activityTime' title="$eventFullDate"&gt;$!timeAgoMsg&lt;/span&gt;
    #end
    #if($isPageEntryExpandable)
      #toolExpand('')
      #displayActivityListItemSummary()
    #end
    #if($isEventEntryExpandable)
      #toolExpand('')
    #end
  &lt;/div&gt;
#end
#**
  * Display the list of events for the current page
  *#
#macro(displayEvents)
  ##
  ## Display events for the current page
  ## -------------------------------------------------------------------
  #foreach($event in $events)
    ##
    ## Event variables
    ## -------------------------------------------------------------------
    #initializeEvent()
    ##
    ## Date header + Start list
    ## -------------------------------------------------------------------
    #if($isToday &amp;&amp; $displayToday)
      #set($closeList = true) ## a new list will be opened
      &lt;h2&gt;$msg.get('timeAgo.today')&lt;/h2&gt;&lt;ul class='activityList'&gt;  ## display 'Today' message
      #set($displayToday = false)
    #elseif($isYesterday &amp;&amp; $displayYesterday) ## display 'Yesterday' message
      #if($closeList) ## there are events today
        &lt;/ul&gt;
      #else
        #set($closeList = true) ## a new list will be opened
      #end
      &lt;h2&gt;$msg.get('timeAgo.yesterday')&lt;/h2&gt;&lt;ul class='activityList'&gt;
      #set($displayYesterday = false)
    #elseif(!$isToday &amp;&amp; !$isYesterday &amp;&amp; $iterationDate != $displayDate) ## display date message
      #set($displayDate = $iterationDate)
      #if($closeList) ## there are events today or/and yesterday
        &lt;/ul&gt;
      #else
        #set($closeList = true) ## a new list will be opened
      #end
      &lt;h2&gt;$!iterationDate&lt;/h2&gt;&lt;ul class='activityList'&gt;
    #end
    ##
    ## Open event list + Display first event
    ## -------------------------------------------------------------------
    #if($velocityCount == 1)
      &lt;li class="activityItem activityPage #if($isPageEntryExpandable)collapsed#end"&gt;
        #displayActivityListItemHeader($isPageEntryExpandable true false)
        #if(!$isPageEntryExpandable) #set($timeAgoMsg = '') #end  ## single entry
        &lt;div class="activityContent"&gt;
          &lt;ul class="activityList"&gt;
    #end
    ##
    ## Display other events (inside the expanded list)
    ## -------------------------------------------------------------------
    #displayEventContent()
    ##
    ## Close page event list
    ## -------------------------------------------------------------------
    #if($velocityCount == $events.size())
          &lt;/ul&gt;
        &lt;/div&gt;
      &lt;/li&gt;
    #end
  #end
#end
#**
  * Display recent activity event list
  *#
#macro(displayRecentActivity)
  #set($iterationDate = '')
  #set($displayDate = '')
  #set($iterationDocuments = $util.arrayList)
  #set($displayToday = true)
  #set($displayYesterday = true)
  #set($closeList = false)
  ##
  ## Get distinct pages with recent activity
  ## -------------------------------------------------------------------
  #set($activitiesQuery = "select page, max(date) from ActivityEventImpl where $!filterClause group by page order by max(date) desc")
  #set($pages = $xwiki.search($activitiesQuery, $rcChangesNb, 0))
  #if ($pages.size() &gt; 0)
    #foreach($page in $pages)
      ##
      ## Extract page name and event date
      ## -------------------------------------------------------------------
      #set($pageName = $page.get(0))
      #set($pageDate = $page.get(1))
      #if($xwiki.hasAccessLevel("view", $context.user, "${context.database}:${pageName}") &amp;&amp; !$iterationDocuments.contains($pageName))
        ##
        ## Get event list for the current page
        ## -------------------------------------------------------------------
        #set($whereClause = " and month(date)=" + ${xwiki.formatDate($pageDate, 'M')} + " and year(date)=" + ${xwiki.formatDate($pageDate, 'yyyy')} + " and day(date)=" + ${xwiki.formatDate($pageDate, 'd')} + " and $!filterClause")
        #set($events= $xwiki.activitystream.searchEvents("act.page='$pageName' and act.space&lt;&gt;'Scheduler' $!whereClause", false, 0, 0))
        #if($events.size() &gt; 0)
          ##
          ## Initialize page event vars
          ## -------------------------------------------------------------------
          #removeDuplicatedEvents()
          #isPageEntryExpandable()
          #getUniqueEventUsers()
          #displayEvents()
        #end
      #end
    #end
    #if($closeList) ## close the last event list
      &lt;/ul&gt;
    #end
  #else
    &lt;span class="noitems"&gt;$msg.get('xe.recentactivity.noentries')&lt;/span&gt;
  #end
  ##
  ## Display RSS URL
  ## -------------------------------------------------------------------
  #if($rcShowRss)
    #displayRSSURL()
  #end
#end
{{/velocity}}

{{velocity}}
{{html}}
  #displayRecentActivity()
{{/html}}
{{/velocity}}</code>
</property>
<property>
<contentDescription></contentDescription>
</property>
<property>
<contentType>No content</contentType>
</property>
<property>
<defaultCategory>Content</defaultCategory>
</property>
<property>
<description>Displays the recent activity in this wiki or in the passed space, if any.</description>
</property>
<property>
<id>recentactivity</id>
</property>
<property>
<name>Recent Activity</name>
</property>
<property>
<supportsInlineMode>0</supportsInlineMode>
</property>
<property>
<visibility>Current Wiki</visibility>
</property>
</object>
<object>
<class>
<name>XWiki.WikiMacroParameterClass</name>
<customClass></customClass>
<customMapping></customMapping>
<defaultViewSheet></defaultViewSheet>
<defaultEditSheet></defaultEditSheet>
<defaultWeb></defaultWeb>
<nameField></nameField>
<validationScript></validationScript>
<defaultValue>
<disabled>0</disabled>
<name>defaultValue</name>
<number>4</number>
<prettyName>Parameter default value</prettyName>
<size>30</size>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.StringClass</classType>
</defaultValue>
<description>
<disabled>0</disabled>
<name>description</name>
<number>2</number>
<prettyName>Parameter description</prettyName>
<rows>5</rows>
<size>40</size>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
</description>
<mandatory>
<disabled>0</disabled>
<displayFormType>select</displayFormType>
<displayType>yesno</displayType>
<name>mandatory</name>
<number>3</number>
<prettyName>Parameter mandatory</prettyName>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
</mandatory>
<name>
<disabled>0</disabled>
<name>name</name>
<number>1</number>
<prettyName>Parameter name</prettyName>
<size>30</size>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.StringClass</classType>
</name>
</class>
<name>Main.RecentActivity</name>
<number>0</number>
<className>XWiki.WikiMacroParameterClass</className>
<guid>822b7323-43ba-4878-8209-7537c9a7c395</guid>
<property>
<defaultValue>false</defaultValue>
</property>
<property>
<description>Whether to show modifications that create minor versions or not.</description>
</property>
<property>
<mandatory>0</mandatory>
</property>
<property>
<name>showMinor</name>
</property>
</object>
<object>
<class>
<name>XWiki.WikiMacroParameterClass</name>
<customClass></customClass>
<customMapping></customMapping>
<defaultViewSheet></defaultViewSheet>
<defaultEditSheet></defaultEditSheet>
<defaultWeb></defaultWeb>
<nameField></nameField>
<validationScript></validationScript>
<defaultValue>
<disabled>0</disabled>
<name>defaultValue</name>
<number>4</number>
<prettyName>Parameter default value</prettyName>
<size>30</size>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.StringClass</classType>
</defaultValue>
<description>
<disabled>0</disabled>
<name>description</name>
<number>2</number>
<prettyName>Parameter description</prettyName>
<rows>5</rows>
<size>40</size>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
</description>
<mandatory>
<disabled>0</disabled>
<displayFormType>select</displayFormType>
<displayType>yesno</displayType>
<name>mandatory</name>
<number>3</number>
<prettyName>Parameter mandatory</prettyName>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
</mandatory>
<name>
<disabled>0</disabled>
<name>name</name>
<number>1</number>
<prettyName>Parameter name</prettyName>
<size>30</size>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.StringClass</classType>
</name>
</class>
<name>Main.RecentActivity</name>
<number>1</number>
<className>XWiki.WikiMacroParameterClass</className>
<guid>c9d7f9c0-5fe8-49e9-86c9-ba04148576d7</guid>
<property>
<defaultValue>true</defaultValue>
</property>
<property>
<description>Whether to show differences for the items in the activity list or not.</description>
</property>
<property>
<mandatory>0</mandatory>
</property>
<property>
<name>showDiff</name>
</property>
</object>
<object>
<class>
<name>XWiki.WikiMacroParameterClass</name>
<customClass></customClass>
<customMapping></customMapping>
<defaultViewSheet></defaultViewSheet>
<defaultEditSheet></defaultEditSheet>
<defaultWeb></defaultWeb>
<nameField></nameField>
<validationScript></validationScript>
<defaultValue>
<disabled>0</disabled>
<name>defaultValue</name>
<number>4</number>
<prettyName>Parameter default value</prettyName>
<size>30</size>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.StringClass</classType>
</defaultValue>
<description>
<disabled>0</disabled>
<name>description</name>
<number>2</number>
<prettyName>Parameter description</prettyName>
<rows>5</rows>
<size>40</size>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
</description>
<mandatory>
<disabled>0</disabled>
<displayFormType>select</displayFormType>
<displayType>yesno</displayType>
<name>mandatory</name>
<number>3</number>
<prettyName>Parameter mandatory</prettyName>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
</mandatory>
<name>
<disabled>0</disabled>
<name>name</name>
<number>1</number>
<prettyName>Parameter name</prettyName>
<size>30</size>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.StringClass</classType>
</name>
</class>
<name>Main.RecentActivity</name>
<number>2</number>
<className>XWiki.WikiMacroParameterClass</className>
<guid>a50d0bbe-21f8-444d-b42f-5d521372d79e</guid>
<property>
<defaultValue>true</defaultValue>
</property>
<property>
<description>Whether to show activity rss links or not.</description>
</property>
<property>
<mandatory>0</mandatory>
</property>
<property>
<name>showRss</name>
</property>
</object>
<object>
<class>
<name>XWiki.WikiMacroParameterClass</name>
<customClass></customClass>
<customMapping></customMapping>
<defaultViewSheet></defaultViewSheet>
<defaultEditSheet></defaultEditSheet>
<defaultWeb></defaultWeb>
<nameField></nameField>
<validationScript></validationScript>
<defaultValue>
<disabled>0</disabled>
<name>defaultValue</name>
<number>4</number>
<prettyName>Parameter default value</prettyName>
<size>30</size>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.StringClass</classType>
</defaultValue>
<description>
<disabled>0</disabled>
<name>description</name>
<number>2</number>
<prettyName>Parameter description</prettyName>
<rows>5</rows>
<size>40</size>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
</description>
<mandatory>
<disabled>0</disabled>
<displayFormType>select</displayFormType>
<displayType>yesno</displayType>
<name>mandatory</name>
<number>3</number>
<prettyName>Parameter mandatory</prettyName>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
</mandatory>
<name>
<disabled>0</disabled>
<name>name</name>
<number>1</number>
<prettyName>Parameter name</prettyName>
<size>30</size>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.StringClass</classType>
</name>
</class>
<name>Main.RecentActivity</name>
<number>3</number>
<className>XWiki.WikiMacroParameterClass</className>
<guid>d5e380c7-3554-48e4-9c4d-c2ec4ca1fe7d</guid>
<property>
<defaultValue>30</defaultValue>
</property>
<property>
<description>Number of activity to show.</description>
</property>
<property>
<mandatory>0</mandatory>
</property>
<property>
<name>changesNb</name>
</property>
</object>
<object>
<class>
<name>XWiki.WikiMacroParameterClass</name>
<customClass></customClass>
<customMapping></customMapping>
<defaultViewSheet></defaultViewSheet>
<defaultEditSheet></defaultEditSheet>
<defaultWeb></defaultWeb>
<nameField></nameField>
<validationScript></validationScript>
<defaultValue>
<disabled>0</disabled>
<name>defaultValue</name>
<number>4</number>
<prettyName>Parameter default value</prettyName>
<size>30</size>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.StringClass</classType>
</defaultValue>
<description>
<disabled>0</disabled>
<name>description</name>
<number>2</number>
<prettyName>Parameter description</prettyName>
<rows>5</rows>
<size>40</size>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
</description>
<mandatory>
<disabled>0</disabled>
<displayFormType>select</displayFormType>
<displayType>yesno</displayType>
<name>mandatory</name>
<number>3</number>
<prettyName>Parameter mandatory</prettyName>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
</mandatory>
<name>
<disabled>0</disabled>
<name>name</name>
<number>1</number>
<prettyName>Parameter name</prettyName>
<size>30</size>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.StringClass</classType>
</name>
</class>
<name>Main.RecentActivity</name>
<number>4</number>
<className>XWiki.WikiMacroParameterClass</className>
<guid>9d0af90f-f2c0-4f22-b555-c20b596bb70e</guid>
<property>
<defaultValue></defaultValue>
</property>
<property>
<description>Comma separated list of tags to display activity for.</description>
</property>
<property>
<mandatory>0</mandatory>
</property>
<property>
<name>tag</name>
</property>
</object>
<object>
<class>
<name>XWiki.WikiMacroParameterClass</name>
<customClass></customClass>
<customMapping></customMapping>
<defaultViewSheet></defaultViewSheet>
<defaultEditSheet></defaultEditSheet>
<defaultWeb></defaultWeb>
<nameField></nameField>
<validationScript></validationScript>
<defaultValue>
<disabled>0</disabled>
<name>defaultValue</name>
<number>4</number>
<prettyName>Parameter default value</prettyName>
<size>30</size>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.StringClass</classType>
</defaultValue>
<description>
<disabled>0</disabled>
<name>description</name>
<number>2</number>
<prettyName>Parameter description</prettyName>
<rows>5</rows>
<size>40</size>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
</description>
<mandatory>
<disabled>0</disabled>
<displayFormType>select</displayFormType>
<displayType>yesno</displayType>
<name>mandatory</name>
<number>3</number>
<prettyName>Parameter mandatory</prettyName>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
</mandatory>
<name>
<disabled>0</disabled>
<name>name</name>
<number>1</number>
<prettyName>Parameter name</prettyName>
<size>30</size>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.StringClass</classType>
</name>
</class>
<name>Main.RecentActivity</name>
<number>5</number>
<className>XWiki.WikiMacroParameterClass</className>
<guid>cd7504db-2ea0-4969-9c80-bd5d31fc9410</guid>
<property>
<defaultValue></defaultValue>
</property>
<property>
<description>Comma separated list of spaces to display the recent activity for.</description>
</property>
<property>
<mandatory>0</mandatory>
</property>
<property>
<name>space</name>
</property>
</object>
<object>
<class>
<name>XWiki.WikiMacroParameterClass</name>
<customClass></customClass>
<customMapping></customMapping>
<defaultViewSheet></defaultViewSheet>
<defaultEditSheet></defaultEditSheet>
<defaultWeb></defaultWeb>
<nameField></nameField>
<validationScript></validationScript>
<defaultValue>
<disabled>0</disabled>
<name>defaultValue</name>
<number>4</number>
<prettyName>Parameter default value</prettyName>
<size>30</size>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.StringClass</classType>
</defaultValue>
<description>
<disabled>0</disabled>
<name>description</name>
<number>2</number>
<prettyName>Parameter description</prettyName>
<rows>5</rows>
<size>40</size>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
</description>
<mandatory>
<disabled>0</disabled>
<displayFormType>select</displayFormType>
<displayType>yesno</displayType>
<name>mandatory</name>
<number>3</number>
<prettyName>Parameter mandatory</prettyName>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
</mandatory>
<name>
<disabled>0</disabled>
<name>name</name>
<number>1</number>
<prettyName>Parameter name</prettyName>
<size>30</size>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.StringClass</classType>
</name>
</class>
<name>Main.RecentActivity</name>
<number>6</number>
<className>XWiki.WikiMacroParameterClass</className>
<guid>c0c73914-3f1a-45e2-a88a-cc8481c66abb</guid>
<property>
<defaultValue></defaultValue>
</property>
<property>
<description>Comma separated list of authors whose modifications to show.</description>
</property>
<property>
<mandatory>0</mandatory>
</property>
<property>
<name>author</name>
</property>
</object>
<content>{{velocity}}
##
## Recent Activity
##
## Optional parameters :
##
## Parameters which can be set in velocity before including this page or can be passed as HTTP parameters.
## Note that HTTP parameters supercede velocity set variables.
##
##  - rcShowRss (String set to "true" or "false"): show RSS at the bottom of the list.
##  - rcSpace (List of string[s]): restrict recent activity retrieval to pages within the given space.
##  - rcTag (List of string[s]): restrict recent activity retrieval to pages with the given tag.
##  - rcAuthor (List of string[s]): restrict recent activity retrieval to pages with the given author.
##  - rcChangesNb (String set to a numerical value): number of pages to display recent activity.
##  - rcPagercPageEventsNo (String set to a numerical value): number of activity events displayed for each page.
##
#if($rcTag)
  #set($rcTagString = "")
  #foreach($rcTagValue in $rcTag)
    #if($velocityCount &gt; 1)
      #set($rcTagString = "${rcTagString}, ")
    #end
    #set($rcTagString = "${rcTagString} ${rcTagValue}")
  #end
#end
#if($rcSpace)
  #set($rcSpaceString = "")
  #foreach($rcSpaceValue in $rcSpace)
    #if($velocityCount &gt; 1)
      #set($rcSpaceString = "${rcSpaceString}, ")
    #end
    #set($rcSpaceString = "${rcSpaceString} ${rcSpaceValue}")
  #end
#end
#if($rcAuthor)
  #set($rcAuthorString = "")
  #foreach($rcAuthorValue in $rcAuthor)
    #if($velocityCount &gt; 1)
      #set($rcAuthorString = "${rcAuthorString}, ")
    #end
    #set($rcAuthorString = "${rcAuthorString} ${rcAuthorValue}")
  #end
#end
## pass the variables from the velocity context
{{recentactivity #if($rcShowRss) showRss="$rcShowRss" #end
                #if($rcChangesNb) changesNb="$rcChangesNb" #end
                #if($rcPagercPageEventsNb) changesNb="$rcPagercPageEventsNb" #end
                #if($rcSpaceString) space="$rcSpaceString" #end
                #if($rcTagString) tag="$rcTagString" #end
                #if($rcAuthorString) author="$rcAuthorString" #end /}}
{{/velocity}}</content>
</xwikidoc>
